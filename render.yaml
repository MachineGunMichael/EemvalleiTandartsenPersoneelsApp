services:
  # Combined Frontend + Backend Service
  - type: web
    name: eemvalleitandartsen-personeel-app
    runtime: node
    region: frankfurt  # EU region for Netherlands
    plan: starter      # Required for persistent disk ($7/month)
    buildCommand: npm install --legacy-peer-deps && npm run build && cd server && npm install
    startCommand: |
      # Initialize database if it doesn't exist
      if [ ! -f /var/data/database.sqlite ]; then
        echo "No database found. Initializing fresh database..."
        mkdir -p /var/data
        mkdir -p /var/data/uploads
        cd server && node init-db.js
        echo "Database initialized with default admin user"
      fi
      cd server && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_PATH
        value: /var/data/database.sqlite
      - key: UPLOADS_PATH
        value: /var/data/uploads
      - key: PORT
        value: 10000
    disk:
      name: data
      mountPath: /var/data
      sizeGB: 1  # 1GB included with Starter plan
