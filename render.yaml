services:
  # Combined Frontend + Backend Service
  - type: web
    name: eemvalleitandartsen-personeel-app
    runtime: node
    region: frankfurt  # EU region for Netherlands
    plan: starter      # Required for persistent disk ($7/month)
    buildCommand: npm install --legacy-peer-deps && npm run build && cd server && npm install
    startCommand: |
      # FORCE copy database (TEMPORARY - revert after successful deploy!)
      echo "Force copying database to persistent disk..."
      mkdir -p /var/data
      cp -f server/database.sqlite /var/data/database.sqlite
      mkdir -p /var/data/uploads
      cp -rf server/uploads/* /var/data/uploads/ 2>/dev/null || true
      echo "Database copied successfully"
      cd server && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: DATABASE_PATH
        value: /var/data/database.sqlite
      - key: UPLOADS_PATH
        value: /var/data/uploads
      - key: PORT
        value: 10000
    disk:
      name: data
      mountPath: /var/data
      sizeGB: 1  # 1GB included with Starter plan
